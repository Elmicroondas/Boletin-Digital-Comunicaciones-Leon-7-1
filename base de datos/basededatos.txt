CREATE DATABASE boletin_digital
  CHARACTER SET utf8mb4
  COLLATE utf8mb4_spanish_ci;

USE boletin_digital;
-- Tabla usuarios
CREATE TABLE usuarios (
  id_usuario INT AUTO_INCREMENT PRIMARY KEY,
  usuario VARCHAR(50) NOT NULL UNIQUE,
  contrasena_hash VARCHAR(255) NOT NULL,
  nombre_completo VARCHAR(100) NOT NULL,
  email VARCHAR(100) NOT NULL UNIQUE,
  dni CHAR(8) NOT NULL UNIQUE,
  rol ENUM('alumno','alumnado','admin') NOT NULL,
  id_curso INT NULL,
  estado_cuenta ENUM('pendiente','aprobado','rechazado') 
      NOT NULL DEFAULT 'pendiente',
  CONSTRAINT fk_usuarios_curso FOREIGN KEY (id_curso)
    REFERENCES cursos(id_curso)
);

-- Tabla cursos
CREATE TABLE cursos (
  id_curso INT AUTO_INCREMENT PRIMARY KEY,
  nombre_curso VARCHAR(20) NOT NULL UNIQUE
);


-- Tabla materias
CREATE TABLE materias (
  id_materia INT AUTO_INCREMENT PRIMARY KEY,
  nombre_materia VARCHAR(100) NOT NULL UNIQUE
);

-- Tabla boletines
CREATE TABLE boletines (
  id_boletin INT AUTO_INCREMENT PRIMARY KEY,
  id_usuario INT NOT NULL,
  id_materia INT NOT NULL,
  anio_lectivo YEAR NOT NULL,

  p1_1c TINYINT UNSIGNED NULL,
  p2_1c TINYINT UNSIGNED NULL,
  nf_1c TINYINT UNSIGNED NULL,

  p1_2c TINYINT UNSIGNED NULL,
  p2_2c TINYINT UNSIGNED NULL,
  nf_2c TINYINT UNSIGNED NULL,

  nota_anual TINYINT UNSIGNED NULL,
  diciembre_acreditacion TINYINT UNSIGNED NULL,
  feb_mar_recuperatorio TINYINT UNSIGNED NULL,
  nota_definitiva TINYINT UNSIGNED NULL,

  CONSTRAINT fk_boletin_usuario FOREIGN KEY (id_usuario)
    REFERENCES usuarios(id_usuario)
    ON DELETE CASCADE,

  CONSTRAINT fk_boletin_materia FOREIGN KEY (id_materia)
    REFERENCES materias(id_materia)
    ON DELETE CASCADE,

  CONSTRAINT uc_boletin UNIQUE (id_usuario, id_materia, anio_lectivo)
);
